<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>던담 모험단 검색</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; }
    input, button { padding: .5rem; font-size: 1rem; }
    ul { list-style: none; padding: 0; }
    li { margin: .5rem 0; background: #f7f7f7; padding: .75rem; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>“슈벨름” 모험단 검색 결과</h1>
  <input id="q" value="슈벨름"/>
  <button id="btn">검색</button>
  <ul id="results"></ul>

  <script>
    async function fetchDundam(name) {
      const proxy     = 'https://api.allorigins.win/raw?url=';
      const targetUrl = `https://dundam.xyz/search?server=adven&name=${encodeURIComponent(name)}`;
      const res       = await fetch(proxy + encodeURIComponent(targetUrl));
      const html      = await res.text();
      const doc       = new DOMParser().parseFromString(html, 'text/html');

      // 1) 각 결과 항목 컨테이너만 CSS 셀렉터로 지정
      const items = doc.querySelectorAll('div.sr-result');
      console.log('found items:', items.length, items);

      return Array.from(items).map(el => {
        // 2) 각 el(결과 항목) 내부에서
        // 캐릭터 이름: div.seh_name > span.name
        const nameEl   = el.querySelector('div.seh_name span.name');
        // 데미지 리포트(여기서는 level 레이블의 숫자): div.level > span.val
        const dmgEl    = el.querySelector('div.level span.val');

        return {
          name:   nameEl?.innerText.trim() ?? '—',
          damage: dmgEl?.innerText.trim()  ?? '—'
        };
      });
    }


    document.getElementById('btn').onclick = async () => {
      const name = document.getElementById('q').value;
      const ul = document.getElementById('results');
      ul.innerHTML = '<li>로딩 중…</li>';

      try {
        const data = await fetchDundam(name);
        ul.innerHTML = '';
        if (data.length === 0) {
          ul.innerHTML = '<li>검색 결과가 없습니다.</li>';
          return;
        }
        data.forEach(item => {
          const li = document.createElement('li');
          li.innerHTML = `<strong>${item.name}</strong> — ${item.damage}`;
          ul.appendChild(li);
        });
      } catch (err) {
        console.error(err);
        ul.innerHTML = '<li>오류가 발생했습니다.</li>';
      }
    };
  </script>
</body>
</html>
