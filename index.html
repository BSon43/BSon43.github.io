<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ë˜ë‹´ ëª¨í—˜ë‹¨ ê²€ìƒ‰</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; }
    input, button { padding: .5rem; font-size: 1rem; }
    ul { list-style: none; padding: 0; }
    li { margin: .5rem 0; background: #f7f7f7; padding: .75rem; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>â€œìŠˆë²¨ë¦„â€ ëª¨í—˜ë‹¨ ê²€ìƒ‰ ê²°ê³¼</h1>
  <input id="q" value="ìŠˆë²¨ë¦„"/>
  <button id="btn">ê²€ìƒ‰</button>
  <ul id="results"></ul>

  <script>
    async function fetchDundam(name) {
      const proxy = 'https://thingproxy.freeboard.io/fetch/';
      const apiUrl = 
        `https://dundam.xyz/dat/searchData.jsp`
        + `?name=${encodeURIComponent(name)}`
        + `&server=adven`;

      const res = await fetch(proxy + apiUrl);
      console.log('Fetch status:', res.status, res.statusText);

      const text = await res.text();
      console.log('Raw response text:', text.slice(0,200));

      let json;
      try {
        json = JSON.parse(text);
      } catch (e) {
        console.error('JSON parse failed:', e);
        return [];
      }

      // 5) JSON êµ¬ì¡° í™•ì¸ í›„ ë§¤í•‘
      //    ğŸ‘‰ ìš°ì„  console.log(json)ë¡œ í•„ë“œ ì´ë¦„ì„ í™•ì¸í•˜ì„¸ìš”!
      // ì˜ˆë¥¼ ë“¤ì–´ json.data.list ê°™ì€ ë°°ì—´ì´ ë“¤ì–´ìˆë‹¤ë©´:
      const list = json.characters || [];

      console.log('Parsed list:', list);

      // 6) ì›í•˜ëŠ” í‚¤ë¡œ êº¼ë‚´ì„œ ë°˜í™˜
      return list.map(item => ({
        name:   item.name           ?? 'â€”',        // ì˜ˆ: "ì˜¤ë˜ë…¸í„´"
        damage: item.ozma           ?? 'â€”'         // ì˜ˆ: "73470"
      }));
    }



    document.getElementById('btn').onclick = async () => {
      const name = document.getElementById('q').value;
      const ul = document.getElementById('results');
      ul.innerHTML = '<li>ë¡œë”© ì¤‘â€¦</li>';

      try {
        const data = await fetchDundam(name);
        ul.innerHTML = '';
        if (data.length === 0) {
          ul.innerHTML = '<li>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
          return;
        }
        data.forEach(item => {
          const li = document.createElement('li');
          li.innerHTML = `<strong>${item.name}</strong> â€” ${item.damage}`;
          ul.appendChild(li);
        });
      } catch (err) {
        console.error(err);
        ul.innerHTML = '<li>ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</li>';
      }
    };
  </script>
</body>
</html>
