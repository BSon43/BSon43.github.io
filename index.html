<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>캐릭터 검색 페이지</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; }
    h1 { text-align: center; margin-bottom: 1rem; }
    .search { display: flex; gap: .5rem; margin-bottom: 1rem; }
    .search select,
    .search input { flex: 1; padding: .5rem; font-size: 1rem; }
    .search button { padding: .5rem 1rem; font-size: 1rem; }
    ul { list-style: none; padding: 0; }
    li { background: #f2f2f2; margin: .5rem 0; padding: .75rem; border-radius: 4px; }
    strong { display: inline-block; width: 140px; }
  </style>
</head>
<body>
  <h1>모험단 서버별 캐릭터 검색</h1>
  <div class="search">
    <select id="serverSelect">
      <option>불러오는 중…</option>
    </select>
    <input id="q" type="text" placeholder="캐릭터명 입력" value="슈벨름"/>
    <button id="btn">검색</button>
  </div>
  <ul id="results"></ul>

  <script>
    // ← 여기에만 API 키를 입력하세요
    const API_KEY = 'YOUR_API_KEY';

    const serverSelect = document.getElementById('serverSelect');
    const input        = document.getElementById('q');
    const btn          = document.getElementById('btn');
    const resultsEl    = document.getElementById('results');

    // 페이지 로드 시 서버 목록을 불러와 <select> 채우기
    async function loadServers() {
      const url = `https://api.neople.co.kr/df/servers?apikey=${API_KEY}`;
      try {
        const res  = await fetch(url);
        const json = await res.json();
        const rows = json.rows || [];
        serverSelect.innerHTML = rows
          .map(r => `<option value="${r.serverId}">${r.serverName}</option>`)
          .join('');
      } catch (e) {
        console.error('서버 목록 로드 실패', e);
        serverSelect.innerHTML = '<option>로드 실패</option>';
      }
    }

    // 선택된 서버 + 입력한 캐릭터명으로 검색
    async function searchCharacters() {
      const server = serverSelect.value;
      const name   = input.value.trim();
      if (!name) return alert('캐릭터명을 입력하세요.');

      resultsEl.innerHTML = '<li>검색 중…</li>';

      // 기본 파라미터: wordType=match, limit=10
      const url =
        `https://api.neople.co.kr/df/servers/${server}/characters`
        + `?characterName=${encodeURIComponent(name)}`
        + `&wordType=match`
        + `&limit=10`
        + `&apikey=${API_KEY}`;

      try {
        const res  = await fetch(url);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const json = await res.json();
        const rows = json.rows || [];

        if (rows.length === 0) {
          resultsEl.innerHTML = '<li>검색 결과가 없습니다.</li>';
          return;
        }

        // 리스트업: 캐릭터명 + 전직명(jobGrowName)
        resultsEl.innerHTML = rows.map(r => {
          const jobGrow = r.jobGrowName || '알 수 없음';
          return `<li>
            <strong>${r.characterName}</strong>
            전직: ${jobGrow}
          </li>`;
        }).join('');
      } catch (e) {
        console.error('검색 실패', e);
        resultsEl.innerHTML = '<li>검색 중 오류가 발생했습니다.</li>';
      }
    }

    // 초기화
    loadServers();
    btn.addEventListener('click', searchCharacters);
  </script>
</body>
</html>
