<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>모험단 서버별 캐릭터 검색</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; }
    .search { display: flex; gap: .5rem; margin-bottom: 1rem; }
    select, input { flex: 1; padding: .5rem; font-size: 1rem; }
    button { padding: .5rem 1rem; font-size: 1rem; }
    ul { list-style: none; padding: 0; }
    li { background: #f2f2f2; margin: .5rem 0; padding: .75rem; border-radius: 4px; }
    strong { display: inline-block; width: 140px; }
  </style>
</head>
<body>
  <h1>모험단 서버별 캐릭터 검색</h1>
  <div class="search">
    <select id="serverSelect"><option>불러오는 중…</option></select>
    <input id="q" type="text" placeholder="캐릭터명 입력" value="슈벨름"/>
    <button id="btn">검색</button>
  </div>
  <ul id="results"></ul>

  <script>
    const API_KEY = 'j3Uxqo3JwNLUNnMzn7v93bXgDpnDB7Ct';  
    // AllOrigins public 프록시 (무료, 별도 설정 불필요)
    const PROXY   = 'https://api.allorigins.win/raw?url=';
    const serverSelect = document.getElementById('serverSelect');
    const input        = document.getElementById('q');
    const btn          = document.getElementById('btn');
    const resultsEl    = document.getElementById('results');

    async function loadServers() {
      const apiUrl   = `https://api.neople.co.kr/df/servers?apikey=${API_KEY}`;
      const fetchUrl = PROXY + encodeURIComponent(apiUrl);
      try {
        const res  = await fetch(fetchUrl);
        const json = await res.json();
        const rows = json.rows || [];
        serverSelect.innerHTML = rows
          .map(r => `<option value="${r.serverId}">${r.serverName}</option>`)
          .join('');
      } catch (e) {
        console.error('서버 목록 로드 실패', e);
        serverSelect.innerHTML = '<option>로드 실패</option>';
      }
    }

    async function searchCharacters() {
      const server = serverSelect.value;
      const name   = input.value.trim();
      if (!name) return alert('캐릭터명을 입력하세요.');

      resultsEl.innerHTML = '<li>검색 중…</li>';
      const apiUrl   = 
        `https://api.neople.co.kr/df/servers/${server}/characters`
        + `?characterName=${encodeURIComponent(name)}`
        + `&wordType=match`
        + `&limit=10`
        + `&apikey=${API_KEY}`;
      const fetchUrl = PROXY + encodeURIComponent(apiUrl);

      try {
        const res  = await fetch(fetchUrl);
        const json = await res.json();
        const rows = json.rows || [];
        if (rows.length === 0) {
          resultsEl.innerHTML = '<li>검색 결과가 없습니다.</li>';
          return;
        }

        resultsEl.innerHTML = rows.map(r => {
          const jobGrow = r.jobGrowName || '알 수 없음';
          return `<li><strong>${r.characterName}</strong> 전직: ${jobGrow}</li>`;
        }).join('');
      } catch (e) {
        console.error('검색 실패', e);
        resultsEl.innerHTML = '<li>검색 중 오류가 발생했습니다.</li>';
      }
    }

    loadServers();
    btn.addEventListener('click', searchCharacters);
  </script>
</body>
</html>
